define(["jquery","core/modal_factory","core/modal_events","core/ajax","core/notification"],function(a,b,c,d,e){var f={SELECTOR:".create-attempt-btn",init:function(){a(f.SELECTOR).click(function(d){d.preventDefault();var e=a(this).closest("table").find("button");f.disableButton(e,!0);var g=a(this).data("message"),h=M.util.get_string("create_attempt_modal_button","quiz_answersheets"),i={quizid:a(this).data("quiz-id"),userid:a(this).data("user-id"),url:a(this).data("url")};b.create({type:b.types.SAVE_CANCEL,title:M.util.get_string("create_attempt_modal_title","quiz_answersheets"),body:g}).done(function(a){return a.setSaveButtonText(h),a.getRoot().on(c.yes,i,f.createAttempt),a.show(),a.getRoot().on(c.hidden,a,f.closeModal),a})["catch"](function(a){f.exceptionHandler(a,e)})})},closeModal:function(b){var c=b.data,d=a(f.SELECTOR).closest("table").find("button");c.destroy(),f.disableButton(d,!1)},createAttempt:function(b){b.preventDefault();var c=b.data,e=a(b.target).find("button");f.disableButton(e,!0);var g=d.call([{methodname:"quiz_answersheets_create_attempt",args:{quizid:c.quizid,userid:c.userid}}]);g[0].then(function(a){var b=a.id||"";return window.location.href=f.updateQueryStringParameter(c.url,"lastchanged",b),!0}).fail(function(a){f.exceptionHandler(a,e)})},disableButton:function(a,b){a.prop("disabled",b)},exceptionHandler:function(a,b){e.exception(a),f.disableButton(b,!1)},updateQueryStringParameter:function(a,b,c){var d=new RegExp("([?&])"+b+"=.*?(&|$)","i"),e=a.indexOf("?")!==-1?"&":"?";return a.match(d)?a.replace(d,"$1"+b+"="+c+"$2"):a+e+b+"="+c}};return f});